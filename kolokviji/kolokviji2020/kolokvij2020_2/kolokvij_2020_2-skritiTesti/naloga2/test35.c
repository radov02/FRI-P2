
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {9289, 5666, 3735, 7570, 3122, 9066, 4128, 557, 37, 2934, 3097, 2777, 8350, 4337, 9754, 9043, 6236, 6148, 6280, 8503, 1951, 6730, 1284, 8614, 3251, 8527, 7316, 8643, 7574, 6231, 1285, 1812, -1},
        (int[]) {3556, 4944, 2272, 2921, 2982, 3124, 5615, 2613, 2345, 7427, 6373, 3913, 3979, 8382, 1068, 4122, 5313, 1404, 8671, 1968, 621, 8929, 4488, 507, 8519, 9337, 8914, 8358, 2249, 6712, 2653, 4043, 1586, 3709, 1603, 7221, 1798, 1785, 4378, 4617, 5541, 1457, 3558, 6037, 7113, 6136, 7245, 1867, 8928, 8912, 2176, 9629, 4623, 6813, -1},
        (int[]) {6476, 6342, 3709, 1791, 4579, 3231, 2440, 2531, 376, 3041, 6552, 7747, 8143, 994, 4762, 1515, 1658, 3872, 1405, 4175, 6979, 9657, 9841, 8418, 1648, 278, 8823, 6811, 3027, 2601, 8802, 6379, 3884, 8522, 4178, 7882, 2656, 6765, 1855, 5534, 1257, 2069, 5344, 8574, 39, 1316, 1068, 714, 5597, 5812, 184, 779, 4211, 9409, 4068, 3923, 7598, 4638, 2787, 2126, 4010, 2128, 1363, 1612, 6825, 1679, 9967, 121, 3721, 8170, 7145, 7397, 1539, 5231, 2135, 1025, 6421, 8583, 1246, 1485, 4811, 2950, 4777, 1470, 2486, 8411, 9870, 384, 2542, 1258, 865, -1},
        (int[]) {9915, 4117, 6775, 4219, 6605, 4833, 8963, 4929, 7027, 8129, 5074, 1430, 5187, 4903, 8971, 6653, 3696, 51, 2315, 1451, 5840, 7253, 535, 1220, 1735, 4253, 4065, 8270, 4323, 9665, 5262, 1994, 8304, 1436, 9962, 981, 8347, 8201, 2301, 852, 7644, 1487, 9643, 3248, 5485, 5883, 3846, 4612, 9198, 457, 1929, 4210, 1969, 8421, 1486, 4728, 994, 3791, 5531, 8005, 5830, 571, 5886, 4533, 9601, 111, 694, 5311, 3667, 1709, 987, 2842, 1341, 9544, 8380, 4468, 8771, 9492, 7063, 9195, 5959, 5614, 8624, 7282, 7094, 7876, 7501, -1},
        (int[]) {1691, 6985, 3940, 5328, 5564, 4124, 7680, 7592, 8768, 4279, 2783, 2142, 9684, 489, 537, 4008, 2149, 8670, 7368, 2258, 9841, 4563, 2912, 5982, 3377, 5529, 1757, 649, 4020, 7879, 5543, 5694, 4183, 7130, 6147, 786, 4954, 6822, 516, 8083, 1160, 9275, 5025, 5469, 7217, 6111, 8415, 1401, 3759, 3630, 4565, 5380, 5721, 939, 7392, 9271, 7458, 1616, 9952, 7334, 2839, 374, 9029, 9368, 2975, 2093, 9051, 7768, 4266, 3613, 9994, 7178, 5184, 7848, 7307, 272, 3977, 5308, 4695, 9900, 1867, 611, 4329, 1276, 6276, 7924, 4647, 1083, 643, 7965, 4328, -1},
        (int[]) {9662, 4686, 4594, 1922, 6407, 1894, 1535, 9235, 3756, 5423, 9111, 3284, 2579, 7738, 2223, 217, 6666, 190, 2964, 4787, 7082, 4519, 1476, 2262, 8763, 9597, 3551, 2521, 2795, 7753, 8803, 1056, 3634, 4182, 9247, 5980, 6338, 1863, 6830, 6097, 7916, 2178, 7595, 1777, 8257, 6696, 7980, 3511, 8767, 7451, 9700, 3502, 5289, 2924, 4776, 6802, 1623, 5168, 4442, 6054, 9962, 1340, 9393, 3295, 454, 8520, 1898, 289, 258, 2819, 7331, 7382, 2915, 7188, 971, 3810, 2912, 8566, 1134, 2586, 796, 5759, 5723, -1},
        (int[]) {2047, 1624, 5115, 5368, 2465, 1995, 5805, 5989, 5006, 3139, 9264, 2449, 2072, 1506, 8171, 388, 731, 7677, 9222, 5618, 9104, 784, 3837, 6639, 6126, 5225, 9200, 4550, 1325, 6478, 7933, 4583, 9240, 1868, 3016, 3519, 2294, 1192, 2337, 5796, 2234, 197, 9007, 5048, -1},
        (int[]) {5173, 3716, 4023, 7140, 1823, 5982, 5659, 4292, 1920, 4941, 6270, 9703, 5660, 9224, 1616, 809, 7810, 8573, 8940, 7533, 2623, 9864, 8766, 9219, 913, 299, 4832, 9353, 7615, 5957, 2783, 8468, 65, 1119, 4961, 5154, 708, 9075, 5825, 7948, 7156, 5936, 2579, 4072, 3138, 5382, 9514, 1750, -1},
        (int[]) {8411, 5959, 6405, 1801, 716, 644, 6344, 4305, 4551, 6625, 5820, 3558, 9922, 775, 3963, 7148, 8858, 3273, 7277, 3543, 695, 6720, 1627, 3453, 3835, 1170, 8829, 1827, 4189, 2233, 8581, 7869, 5421, 3643, 9596, 8879, 1736, 6253, 3172, 6013, 8309, 3541, 9935, 2420, 8928, 5135, 6175, 7308, 6769, 9085, 5301, 4748, 711, 9364, 5393, 3619, 8547, 6989, 1517, 7095, 3060, 452, 7208, 9952, 385, 6352, 2661, 1741, 2825, 4029, 8943, 5182, 3524, 996, 7757, 5118, 7997, 5451, 2750, 8796, 8377, 3489, 3517, 7307, 5887, 30, 199, 894, -1},
        (int[]) {9784, 7222, 6286, 674, 6428, 8058, 9375, 3545, 277, 5341, 5995, 9621, 6173, 9817, 1900, 3195, 7993, 4241, 6324, 7576, 526, 8772, 1993, 452, 2564, 536, 514, 5701, 2288, 2991, 5412, 908, 7843, 8565, 1137, 6853, 3814, 2100, 4328, 4386, 6179, 8072, 781, 131, 9991, 2334, 2173, 4615, 38, 3885, 9837, 8091, 7476, 2076, 8970, 7250, 7873, 324, 6890, 8850, 9637, 1957, 2710, 3309, 4955, 1395, 4218, 1104, 8147, 2305, 3385, 4558, 6956, 4931, 8073, 9363, 8660, 6643, 7845, 1257, 5538, 1393, 2898, 525, 9325, 7517, 8469, 5815, 8796, 144, 5329, 3942, -1},
        (int[]) {8487, 5773, 4106, 1348, 5272, 9109, 9683, 5569, 3521, 6828, 3995, 251, 8934, 4251, 2378, 5390, 2083, 2168, 6161, 6988, 497, 713, 3272, 7916, 2214, 6773, 127, 4322, 3990, 9531, 4559, 4786, 4802, 8362, 1948, 3174, 9801, 1879, 4004, 7986, 7833, 1654, 1973, 4839, 6785, 6165, 8987, 6354, 4170, 9453, 676, 8733, 2856, 201, 1843, 2537, 6832, 5314, 6132, 2377, 1082, 2277, 1547, 1884, 5571, 8682, 5299, 6805, 4309, 9710, 5377, 2768, 8997, 3247, 6024, 6372, 6004, 4131, 9707, 4053, 9234, 5007, 1566, 4026, 3408, 1488, -1},
        (int[]) {2283, 7164, 7830, 9872, 8678, 4818, 5618, 852, 8714, 2967, 8253, 1550, 7382, 5444, 740, 6044, 1656, 2323, 2900, 5280, 307, 3659, 8888, 2433, 9921, 8937, 6307, 7370, 539, -1},
        (int[]) {9341, 5275, 4676, 1183, 4361, 5735, 8426, 37, 6622, 305, 5075, 137, 6699, 8009, 4007, 25, 5309, 2453, 1108, 2943, 7385, 2649, -1},
        (int[]) {4941, 8326, 5880, 5954, 5943, 1239, 4809, 1205, 9167, 4942, 8984, 8229, 3325, 282, 8551, 7394, 5810, 5146, 7282, 6320, 4365, 4978, 5058, 7526, 4172, 2579, 2729, 1889, 5903, 3235, 8928, 9338, 5627, 378, 4376, 7982, 3623, 2855, 4323, 8336, 2020, 6693, 6683, 5203, 8799, 479, 7988, 2412, 4155, 8486, 1931, 7221, 3893, 955, -1},
        (int[]) {3234, 117, 6392, 1067, 9546, 2037, 3050, 7674, 2712, 8053, 4392, 5679, 4101, 3128, 3361, 8458, 9544, 79, 7857, 4394, 3068, 2963, 8035, 9936, 3123, 9867, -1},
        (int[]) {423, 4273, 5433, 8920, 2781, 6590, 9032, 2430, 9097, 9023, 8632, 6729, 4733, 5329, 7259, 2778, 3690, 2783, -1},
        (int[]) {7188, 8890, 1240, 4443, 4488, 4282, 6838, 335, 542, 3872, 9566, 9496, 5757, 9504, 1788, 8856, 9583, 5353, 9436, 9110, 3812, 7720, 9202, 7312, 3107, 8032, 5930, 4151, 4942, 6986, 9898, 7317, 3601, 4918, 121, 8642, 4753, 4178, 1773, 4892, 285, 9201, 7514, 19, 7205, 6493, 9771, 7645, 5133, 2482, 1558, 9578, 6851, 3442, 4906, 3919, -1},
        (int[]) {5804, 9168, 1202, 7868, 7469, 4025, 2369, 717, 7232, 1093, 2524, 1333, 8450, 2683, 8156, 3297, 7432, 6745, 2412, 9290, 885, 3898, 3034, 259, 7438, 7402, 5024, 9474, 4007, 8566, 65, 9910, 115, 4393, 7945, 9893, 3973, 3997, 6867, 113, 4846, 1799, 7968, 820, 3906, 1953, 8182, 4756, 5035, 8678, 5000, 3351, 5136, 3929, 9250, 1486, 346, 767, 2772, 1119, 1964, 4013, 882, 6777, 1546, 4322, 8683, 6088, 1360, 8073, 9109, 8923, 1886, 3126, 4593, 6538, 9282, 4194, 7384, 2924, 9102, 2239, 7436, 328, 4094, 3819, 311, 724, 4122, 2057, -1},
        (int[]) {2651, 3477, 2028, 4014, 4023, 6877, 549, 7033, 5046, 8134, 1651, 5678, 4769, 5401, 7008, 4397, 8524, 6195, 2688, 2089, 8966, 2096, 2576, 8411, 4227, 8833, 6878, 4998, 2736, 7482, 7288, 1574, 7639, 8, 9814, 1831, 9037, 564, 2574, 4940, 8670, 9774, 7660, 576, 6158, 8733, 6198, 9762, 4732, 6338, 6947, 6833, 5835, 6700, 9076, 8100, 5219, 8662, 6391, 7161, 7909, 9574, 5737, 9650, 5031, 2821, 6254, 4373, 4, 5943, 2199, 3540, 3034, 9948, 5026, 8897, 7135, 3465, 3955, 4670, 7636, 299, 2280, 6962, 9229, 5893, 7844, -1},
        (int[]) {422, 5729, 9352, 8391, 547, 8406, 1840, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
