
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {2708, 462, 6154, 4001, 9416, 8166, 5597, 9454, 5289, 4045, 9449, 9958, 1991, 4794, 3407, 1386, 3891, 7707, 6246, 4128, 7967, 4243, 7934, 4425, 6361, 4880, 8507, 1760, 1532, 7326, 4101, 2340, 1128, 5104, 6604, 8580, 2534, 5657, 8250, 6918, 9130, 2104, 1990, 2085, -1},
        (int[]) {2738, 5387, 231, 3362, 4010, 6877, 520, 1950, 6756, 8945, 9121, 9633, 9617, 6288, 5589, 1318, 6200, 7677, 3219, 8107, 6414, 4767, 1356, 355, 9867, 7273, 3913, 3152, 7555, 5256, 1243, 8554, 2443, 4292, 6583, 1734, 2242, 9957, 9101, 5711, 24, 4465, 8787, 1082, 317, 8803, 3939, 5778, 6979, 4222, 11, 9063, 9997, 7540, 1629, 4105, 9014, 1471, 5332, 2920, 3801, 2491, 6290, 5541, 583, 3391, 9844, 9546, 6478, 26, 2862, 635, 9995, 7035, 8953, 8801, 1447, 4245, 2665, 7213, 3813, 2104, 8091, 756, 9656, 144, 6481, 1469, 5917, 7215, 9807, 6803, 9794, 1237, 1470, 3032, 2092, 3385, 7530, 6232, -1},
        (int[]) {7939, 4656, 9254, 2183, 6824, 6901, 8923, 3996, 7669, 6821, 3815, 3151, 1119, 6084, 6889, 9499, 5742, 4173, 4834, 1776, 2671, 3770, 7572, 6136, 9369, 6442, 6168, 9828, 2832, 8450, 645, 2564, 2260, 1007, 9240, 6942, 2475, 3403, 8929, 1085, 8887, 4598, 3094, 2866, 1140, 4988, 9585, 3876, 6714, 9478, 2666, 6974, 5190, 6237, 758, 634, 9393, 7745, 6573, 4719, 2495, 6798, 9145, 6225, 2351, 733, 7341, 8766, 8103, 1161, 5193, 2209, 3899, 8170, 7162, 9024, 3376, 6465, 978, 3240, 8911, 473, 1977, 2837, 7820, 1054, 6054, 2189, 8159, 3634, 1815, 6023, -1},
        (int[]) {9657, 8078, 2719, 4761, 4401, 3703, 2456, 7470, 8592, 5722, 578, 2526, 9236, 7458, 9838, 5386, 2407, 3726, 4135, 7820, 6672, 5075, 4526, 6196, 5128, 5211, 1171, 6404, 4146, 2938, 3074, 7770, 6385, 652, 217, 776, 658, 5444, 1898, 7560, 4464, 674, 5903, 7451, 5629, 733, 6802, 1447, 6879, 8716, -1},
        (int[]) {2944, 4122, 5819, 91, 5583, 336, 2751, -1},
        (int[]) {1835, 3825, 5252, 4358, 6908, 4131, 2847, 7957, 4555, 2636, 4419, 5261, 2521, 5935, 8696, 8965, 723, 5050, 2613, 8213, 2282, 1085, 457, 8347, 2499, 1532, 2983, 1056, 8139, 2138, 1643, 2593, 9838, 6718, 8575, 6045, 9986, 1829, 1780, 6835, 8942, 1725, 1474, 5659, 4058, 1448, 4153, 3605, 208, 5584, 2102, 5320, 8622, 6150, -1},
        (int[]) {6497, 630, 1250, 6535, 975, 3861, 5398, 8632, 8963, 3792, 1840, 8989, 5791, 7571, 6206, 5455, 9238, 2582, 6192, 6593, 2940, 2756, 3780, 9956, 4446, 7153, 2232, 519, 3540, 3211, 9141, 2513, 2267, 1958, 5564, 2312, 4873, 4626, 1168, 5714, 8631, 2766, 7610, 5198, 8642, 7362, 8815, 8580, 9156, 9648, 1185, 8225, 3988, 149, 4534, 1621, 7409, 8771, 803, 2962, 8803, 9737, 8327, 1656, 1259, 4661, -1},
        (int[]) {9500, 7773, 2046, 2468, 2973, 1723, 5436, 5363, 6648, 654, 1642, 5120, 8233, 1319, 7000, 5892, 3465, 5608, 2461, 1380, 7117, 1261, 4674, 7287, 1422, 8616, 868, 4584, 4788, 7367, 8497, 8763, 4148, 3684, 1588, 28, 3885, 7915, 6329, 1250, 2796, 5578, 8111, 6771, 4573, 5666, 2135, 9130, 5209, 1519, 3742, 8285, 8716, 8570, 527, 5473, 8186, 3094, 9568, 6143, 6844, 9968, 7514, 491, 8255, 6555, 9023, 4735, 8821, 2749, 4916, 9916, 536, 4924, 7244, 9881, 3081, 4483, 9482, 7230, 5565, 8005, 8758, 1941, 7943, -1},
        (int[]) {1598, 2501, 4341, 8792, 3913, 6881, 5899, 6998, 2106, 8669, 4999, 7438, 8503, 7660, 953, 4023, 1076, 6424, 2141, 1592, 4874, 7609, 6172, 4298, 6893, 4430, 8441, 9395, 1460, 5807, 5930, 2351, 6501, 3165, 1691, 1561, 4146, 4505, 2158, 3847, 5981, 5151, 5390, 1669, 509, 236, 515, 1612, 4044, 337, 8324, 7109, 6265, 7737, 5642, 8041, 6836, 5289, 2839, 8016, 3357, -1},
        (int[]) {2882, 3913, 1834, 9257, 9387, 6253, 525, 6051, 5686, 5661, 9756, 8079, 9502, 4265, 1845, 1584, 6097, 1204, 7994, 3359, 7801, 2740, 2668, 7279, 8170, 7715, 9250, 7320, 7170, 8394, 9937, 8957, 640, 9510, 4791, 1469, 664, 1632, 1600, 5512, 5469, 1969, 9350, 4896, 8727, 9832, 3811, 5044, 7840, 7660, 4888, 4105, 8345, 6022, 7065, 4531, 649, 124, 536, 4592, 691, 7484, 1655, 3021, 6159, 8470, 2656, 9316, 6795, 1745, 7306, 4670, 4582, -1},
        (int[]) {5694, 6861, 3813, 1460, 2020, 7505, 1504, 9680, 9713, 6018, 8970, 8801, 7328, 9550, 6486, 8435, 2747, 9524, 459, 9170, 3292, 1901, 6931, 7668, 5231, 2811, 3015, 5680, 5460, 1787, 713, 1512, 2231, 4433, 4239, 8947, 7317, 6337, 6207, 2351, 9630, 7906, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
