
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {5289, 9188, 244, 2068, 307, 1387, 2202, 2464, 3147, 7933, 7766, 149, 1640, 3287, 6419, 7394, 8152, 167, 7491, 3780, 4229, 7744, 3463, 7111, 8225, 6420, 6612, 2874, 4090, 8997, 8872, 9822, 3683, 6911, 4697, 2549, 8984, 4713, 9127, 1117, 4466, 7068, 5854, 1159, 3362, 2179, 7635, 7564, 5505, 4875, 3418, 3310, 2003, 9956, 4376, 7714, 1916, 3188, 5593, 2074, 7907, 9123, 8711, 2030, 299, 5233, 1026, 4913, 3949, 4802, 191, 7433, 2688, -1},
        (int[]) {8897, 7590, 1791, 8604, 1656, 4354, 5800, 1528, 8855, 6198, 3959, 9214, 6562, 4834, 8249, 1143, 9543, 629, 2780, 4532, 8409, 3746, 4639, 3711, 3036, 3395, 7034, 7179, 3826, 527, 9293, 1512, 2761, 7050, 9262, 9206, 2697, 6541, 5255, 2120, 1813, 4804, 5878, 4008, 1147, 4087, 564, 136, 4437, 3249, 9166, 3466, 2850, 8995, 2851, 6335, 258, 9689, 3103, 8340, 693, 1, 4767, 2258, 4964, 178, 4801, 2380, 1495, 5873, 504, 7347, 8729, -1},
        (int[]) {3247, 7284, 7932, 242, 4859, 1158, 553, 3257, 740, 8254, 9284, 612, 8043, 3695, 3553, 6381, 830, 9214, 8273, 854, 8013, 171, 4833, 5650, 3617, 375, 3915, 8935, 6431, 9792, 4516, 9327, 868, 7064, 9186, 5123, 1308, 4224, 1419, 5143, 48, 3683, 7350, 174, 5271, 1582, 8697, 8251, 5085, 8632, 8867, 4414, 6632, 7787, 6486, 3806, 4104, 7669, 944, 8629, 2531, 8158, 1267, 8713, 7708, 1430, 3532, 6474, 2305, 9941, 6076, 5731, 7521, -1},
        (int[]) {3221, 6095, 8744, 9207, 5667, 9287, 5701, 5444, 3181, 3427, 9334, 8464, 2930, 3128, 9785, 1563, 775, 1247, 8591, 2044, 1822, 5600, 7985, 7942, 6617, 4225, 1934, 481, 5915, 4699, 9753, 4273, 2245, 5772, 6807, 5485, 467, 4509, 7219, 3861, 1638, 1623, 227, 4301, 7250, 5876, 8493, 511, 9736, 4090, 6219, 6632, 886, 7473, 521, 7782, 4189, 9341, 8929, 857, 9603, 5732, 1519, 9005, 9169, 4384, 4847, 8108, 2502, 7983, 8926, 7368, 1815, -1},
        (int[]) {4262, 2475, 9068, 7210, 2511, 9921, 7354, 4085, 6711, 3012, 5262, 2601, 7421, 7272, 2572, 6910, 5663, 511, 7351, 1419, 6683, 5601, 8937, 5471, 9856, 8113, 3271, 8762, 852, 572, 3757, 3279, 1067, 7252, 5720, 7195, 2422, 2651, 4321, 8692, 7175, 4201, 7948, 2464, 1006, 5257, 8580, 7120, 1206, 7963, 6699, 9761, 9095, 1621, 3717, 8567, 7058, 6817, 1334, 1211, 7997, 4336, 3575, 1216, 7144, 2893, 9163, 9962, 5881, 1874, 4721, 4081, 5972, -1},
        (int[]) {6667, 8770, 3436, 8205, 8732, 5844, 9348, 4616, 9463, 7812, 1380, 1331, 3073, 2535, 3420, 7218, 8604, 2623, 3897, 8730, 3922, 2917, 9154, 1693, 8659, 6052, 5960, 2973, 7559, 9804, 6409, 181, 5310, 5467, 2810, 4789, 7052, 6917, 9110, 7273, 5007, 5800, 4330, 1660, 602, 2347, 2799, 7282, 4257, 8728, 1376, 7088, 8055, 6462, 1554, 2493, 9954, 281, 16, 6986, 3141, 8043, 7544, 9054, 6796, 8976, 4863, 8332, 2233, 2015, 5837, 3393, 1213, -1},
        (int[]) {9311, 5886, 688, 8589, 9830, 9301, 171, 5078, 4194, 3988, 7279, 8331, 9863, 6364, 6411, 5736, 2108, 6421, 4384, 7096, 841, 9635, 4272, 4310, 227, 2626, 8735, 4728, 5698, 6313, 8550, 8877, 5574, 7257, 4053, 6541, 7417, 4196, 6497, 1972, 4811, 6802, 3336, 2497, 8238, 3150, 9659, 527, 8109, 2840, 6063, 428, 7193, 1320, 2679, 4062, 139, 719, 3, 7053, 9160, 3650, 7232, 7553, 643, 3370, 609, 4821, 6920, 3737, 2421, 5635, 4631, -1},
        (int[]) {8665, 9884, 8982, 6246, 7369, 1526, 947, 21, 4514, 4132, 9877, 8139, 7305, 4038, 1295, 9420, 3733, 2374, 5384, 4455, 5005, 3936, 6100, 7575, 2537, 6126, 4578, 3404, 3325, 3696, 3085, 3650, 6033, 5635, 1390, 4640, 7427, 6381, 5914, 9909, 5150, 3220, 7389, 6488, 2089, 6041, 8492, 9994, 3746, 2989, 2346, 6847, 1487, 8221, 3609, 4810, 9970, 9866, 9333, 9421, 1107, 5960, 196, 1155, 8609, 4291, 7054, 5588, 8576, 644, 7029, 6623, 3136, -1},
        (int[]) {7555, 8503, 1123, 5739, 4204, 2700, 6191, 5862, 8567, 4400, 8791, 8271, 4974, 8435, 5566, 577, 6856, 9812, 276, 7864, 1555, 2956, 2943, 8876, 1932, 3045, 1893, 9093, 3203, 6381, 9243, 9337, 6711, 6867, 8900, 262, 7754, 8278, 433, 7934, 9491, 4499, 7981, 5323, 2856, 3266, 1771, 158, 3919, 2152, 5325, 5925, 7949, 3027, 5754, 1804, 3950, 8249, 9027, 9383, 3479, 53, 8815, 3351, 9748, 5688, 1463, 9751, 6310, 4196, 7320, 2647, 2087, -1},
        (int[]) {9453, 2513, 2196, 6318, 4656, 932, 7920, 7457, 1003, 6083, 4560, 171, 6335, 6444, 5269, 1353, 1968, 8097, 7068, 6322, 7656, 9622, 2609, 4645, 4767, 2726, 9745, 9809, 2834, 6330, 6914, 1395, 100, 8243, 5086, 9038, 5826, 8888, 7976, 2641, 5257, 2377, 5214, 7592, 1807, 8548, 2158, 3320, 913, 6519, 8961, 1689, 5031, 33, 7207, 3471, 5433, 7190, 3802, 4334, 1854, 415, 8210, 4280, 2219, 1300, 1414, 7308, 9193, 6505, 5552, 5693, 1153, -1},
        (int[]) {2984, 2857, 6227, 1740, 5884, 4277, 5912, 6359, 253, 8631, 2504, 6274, 816, 3071, 8627, 2465, 683, 4982, 8332, 818, 2361, 3743, 5699, 7220, 8141, 1421, 7386, 1689, 9929, 711, 9807, 1800, 9413, 3274, 7597, 1571, 4107, 3682, 1527, 9627, 1625, 2469, 158, 9270, 2676, 6893, 404, 6350, 4730, 6114, 68, 7721, 1292, 7252, 1406, 6761, 8840, 8999, 5324, 9459, 9781, 8304, 8793, 6659, 4176, 9382, 6099, 1261, 3439, 456, 8477, 3313, 915, -1},
        (int[]) {7055, 2416, 7606, 7489, 2881, 3577, 725, 1347, 8142, 2958, 8709, 6814, 430, 9076, 5101, 6510, 6748, 4059, 2349, 5561, 2012, 6416, 5045, 7051, 2598, 9678, 902, 6875, 8257, 2196, 7415, 8083, 4235, 3007, 528, 4847, 9620, 1124, 8603, 3965, 3132, 2593, 4987, 7789, 5407, 2653, 2013, 5868, 1500, 1037, 4161, 8161, 9013, 7531, 3621, 1929, 5105, 5115, 640, 2933, 4073, 8571, 3547, 5541, 358, 3706, 5150, 7377, 2668, 361, 1163, 5570, 4635, -1},
        (int[]) {2676, 6534, 9784, 7184, 8733, 2082, 4075, 658, 6140, 5248, 1131, 2555, 661, 6664, 5442, 1581, 8250, 7215, 8069, 4717, 1003, 19, 4970, 8240, 8416, 1986, 2349, 5666, 3917, 5872, 5469, 5685, 6000, 1963, 438, 7018, 3461, 3155, 3293, 2061, 9119, 6581, 2244, 3381, 1712, 8281, 1960, 4557, 2820, 1346, 2255, 2514, 55, 7383, 2771, 3383, 3985, 241, 3748, 9555, 4919, 4882, 30, 5570, 203, 5752, 3682, 2611, 1299, 1543, 8312, 7444, 7670, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
