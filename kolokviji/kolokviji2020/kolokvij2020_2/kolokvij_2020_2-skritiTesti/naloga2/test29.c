
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {1653, 6675, 1987, 8971, 709, 4262, 9648, 7835, 93, 737, 8902, 8015, 295, 5328, 5950, 2188, 3241, 5974, 71, 6245, 3570, 5004, 3361, 8979, 1764, 8491, 8294, 1454, 3557, 8814, 8634, 1668, 4812, 2269, 5474, 2948, 1585, 1036, 8115, 3837, 9121, 9302, 763, 9066, 8640, 6286, -1},
        (int[]) {1571, 6332, 8137, 5562, 8013, 6633, 4783, 3113, 9374, 9943, 3285, 5786, 1060, 14, 4291, 1278, 5392, 678, 6890, 5097, 6695, 214, 5507, 9166, 6028, 9971, 5868, 2361, 5109, 7041, 1661, 5032, 4584, 3709, 5248, 7814, 3143, 8528, 2792, 3881, 6969, 9458, 6536, 931, 6917, 3569, -1},
        (int[]) {518, 1849, 2210, 8867, 3145, 218, 7893, 9021, 4036, 1193, 4794, 4318, 8095, 4393, 1118, 5157, 5413, 7199, 5519, 7268, 5048, 8584, 1869, 8945, 5100, 1274, 6930, 2786, 2118, 6157, 9175, 4856, 9874, 392, 8077, 3407, 4326, 2763, 3480, 1303, 7575, 2830, 5496, 893, 7039, 3132, -1},
        (int[]) {4107, 1884, 348, 3399, 5041, 7743, 6310, 2942, 6865, 181, 3054, 6381, 8440, 8475, 9432, 8360, 1449, 1138, 366, 1620, 6460, 8633, 487, 7303, 6702, 5301, 2884, 7581, 118, 4165, 5315, 7486, 9877, 6385, 5226, 9041, 850, 4194, 2691, 2048, 1437, 8242, 6158, 9978, 4033, 5255, -1},
        (int[]) {2457, 366, 6145, 1726, 3395, 5384, 6707, 1666, 8713, 7504, 7016, 9004, 5444, 600, 5485, 7873, 8699, 8035, 9685, 35, 8561, 8808, 4714, 8167, 1839, 2358, 8283, 125, 6783, 357, 298, 5105, 1426, 1472, 1415, 1485, 4484, 3107, 1657, 1255, 4718, 4201, 8286, 7738, 1, 4558, -1},
        (int[]) {9637, 8657, 5363, 163, 7918, 9417, 5342, 9256, 3281, 4318, 965, 5334, 7353, 4475, 1611, 9593, 6680, 1523, 4194, 8945, 1321, 748, 5515, 7764, 711, 787, 9590, 9587, 9279, 8360, 688, 9854, 9436, 4173, 760, 881, 5333, 5923, 3353, 8761, 4389, 2045, 6985, 8763, 8506, 6659, -1},
        (int[]) {911, 7031, 425, 5389, 6585, 8821, 7514, 1798, 5407, 7653, 1498, 8969, 7237, 3914, 7263, 2404, 9914, 925, 8101, 1072, 5606, 234, 1001, 5388, 7296, 1395, 6728, 1024, 1668, 8126, 5181, 9918, 3356, 771, 5405, 8588, 3514, 5236, 9478, 5082, 9718, 7054, 9714, 1242, 1350, 3380, -1},
        (int[]) {6791, 7682, 2394, 6587, 2422, 2690, 1875, 8948, 8162, 2578, 2786, 2584, 7551, 7247, 7051, 7101, 4504, 2616, 1176, 4560, 104, 6404, 2343, 7031, 4335, 1887, 856, 6218, 2174, 7973, 9363, 3335, 9152, 7399, 6217, 953, 7609, 369, 2651, 7413, 1802, 8584, 6779, 2771, 8951, 2159, -1},
        (int[]) {3287, 6186, 6746, 8357, 7206, 5680, 8248, 1494, 7820, 2256, 3268, 1392, 8628, 8332, 4277, 1630, 6140, 7659, 3361, 1618, 5769, 4166, 3061, 2947, 4616, 6946, 1480, 9557, 4449, 2457, 7305, 4063, 9011, 6395, 2561, 603, 4010, 4309, 5871, 5278, 2270, 7930, 3935, 5533, 7121, 107, -1},
        (int[]) {3031, 2013, 1073, 5562, 1675, 4568, 3203, 4229, 2661, 58, 8685, 4115, 2964, 3673, 4518, 5883, 5779, 993, 5994, 2927, 885, 9811, 7402, 7084, 34, 9564, 557, 1564, 894, 4864, 2169, 9255, 4306, 673, 2995, 9204, 2487, 4906, 3819, 5378, 3335, 6707, 1660, 8742, 4917, 1513, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
