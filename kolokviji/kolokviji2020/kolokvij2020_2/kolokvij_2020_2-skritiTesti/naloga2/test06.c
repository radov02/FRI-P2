
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {3055, 5121, 523, 3655, 9214, 7561, 417, 5741, 3678, 419, 2932, 2104, 3821, 2772, 3357, 9130, 1008, 5451, 9405, 3104, 9606, 4185, 6075, 4286, 5946, 1069, 9475, 6110, 5066, 1396, 7027, 6463, 5606, 6100, 4696, 3843, 1928, 200, 5940, 6079, 7537, 7028, 5731, 1733, 4231, 1016, 2585, 6977, 8583, 5791, 5982, 115, 1811, 1204, 4365, 2765, 780, 429, 6384, 1029, 1183, 4456, 8440, 4355, 3615, 7883, 8048, 7810, 4865, 9723, 2910, 2945, 2537, 569, 7600, 1819, 8718, 3218, 4444, 4118, 4194, 1746, 5341, 3286, 8827, 2162, 8641, 2899, 7931, 165, 5350, 3322, 6047, 7126, 5905, 1957, 3445, 93, 573, 2891, 9697, 2856, 8401, 2371, 4407, 8624, 9694, 6057, 386, 2070, 2964, 9178, 3777, 6360, 9511, 9970, 6650, 7414, 4453, 7040, 5776, 5855, 7430, 7446, 8199, 1278, 2890, 2430, 2706, 9456, 2818, 3718, 5353, 4699, 3473, 6011, 9812, 9181, 9086, 7132, 3699, 6293, 1600, 8073, 339, 2983, 9444, 2218, 5621, 2583, 8036, 5862, 4758, 9467, 3314, 8522, 4577, 5640, 6639, 9354, 1107, 9477, 51, 5768, 2673, 2271, 9504, 7032, 6373, 8966, 4938, 1232, 5285, 4357, 3866, 6282, 8211, 9392, 1470, 1535, 1978, 9678, 3967, 300, 5498, 4734, 9713, 600, 8013, 8035, 1835, 7271, 2122, 3500, 1152, 4275, 2768, 8888, 9797, 365, 4545, 8769, 2569, 5132, 7131, 9104, 71, 5732, 6035, 8119, 2535, 4872, 1213, 2481, 7962, 973, 9545, 7097, 4689, 4471, 1260, 5619, 6446, 2350, 5255, 2616, 8806, 7575, 8455, 3826, 3090, 8593, 7168, 3356, 4049, 1613, 8548, 5841, 3803, 7064, 8786, 6931, 8407, 2727, 9641, 2868, 4676, 6262, 2412, 6733, 2558, 6137, 236, 2136, 5974, 4612, 9988, 1518, 4475, 4932, 49, 8052, 8217, 2704, 7595, 8429, 5426, 1594, 9001, 8209, 9578, 4666, 2897, 7062, 9820, 6374, 5416, 318, 4900, 3343, 8758, 3411, 5059, 4093, 3173, 4929, 6178, 2210, 655, 9223, 8361, 4186, 6200, 8031, 4974, 1301, 7363, 9936, 3381, 1383, 3452, 3841, 1277, 4363, 9507, 9297, 9466, 99, 3096, 3360, 7069, 7944, 5274, 210, 3117, 8256, 7254, 7150, 3890, 8968, 729, 4650, 7373, 6419, 2692, 1873, 525, 9835, 1076, 1200, 1589, 1520, 7874, 4072, 154, 9515, 9930, 2202, 845, 6451, 8215, 3494, 1364, 1425, 9416, 3767, 2620, 6713, 5388, 76, 6254, 8541, 2821, 3622, 4731, 9898, 4992, 8282, 854, 5876, 8029, 6796, 4354, 8670, 9350, 4561, 683, 5330, 3227, 7227, 472, 8056, 5755, 3244, 2464, 7138, 9563, 8804, 9192, 4146, 4197, 3448, 401, 980, 8753, 8120, 1142, 6793, 5837, 8759, 9951, 4571, 7022, 7994, 4396, 1095, 5104, 3144, 8441, 391, 662, 4614, 7894, 2607, 7588, 1131, 5165, 2336, 4298, 1004, 7778, 3067, 5141, 4681, 9230, 7958, 9382, 8625, 7286, 5547, 3134, 4719, 8770, 7903, 8558, 5592, 7825, 3045, 8162, 6847, 9224, 6538, 2387, 4161, 3093, 9461, 5918, 0, 933, 6119, 9162, 6449, 6619, -1},
        (int[]) {8366, 362, 4922, 4957, 8282, 4554, 841, 8949, 3752, 2888, 3358, 9768, 1427, 7474, 4939, 4259, 6098, 4271, 6581, 9809, 413, 1411, 9075, 7018, 8281, 1456, 7762, 275, 4736, 2104, 3650, 9235, 2662, 3667, 2632, 7192, 5501, 8134, 8161, 3324, 1639, 6945, 8083, 6235, 6698, 9260, 396, 8247, 8512, 2471, 4996, 9733, 8289, 5102, 7672, 7803, 8032, 9947, 3426, 6096, 5403, 7732, 9895, 2618, 5589, 7194, 1102, 4875, 9233, 2950, 2182, 9333, 7004, 8786, 9, 7873, 1369, 9685, 3338, 8918, 2835, 8680, 5541, 7961, 4353, 9847, 5036, 8251, 6190, 8105, 8815, 9577, 555, 379, 818, 6202, 9962, 9014, 247, 5207, 6079, 7929, 5422, 2845, 2855, 3834, 7181, 3539, 5001, 9140, 6924, 7793, 6949, 3376, 3568, 1332, 5112, 2768, 9775, 7753, 9596, 8128, 2787, 1635, 808, 747, 7349, 8991, 480, 9476, 1985, 9566, 9645, 1049, 2204, 5242, 4995, 6367, 8660, 9437, 5795, 5615, 1695, 7972, 453, 9515, 6528, 7533, 3238, 5333, 6387, 994, 2073, 8021, 6615, 4608, 759, 478, 657, 4106, 9802, 8807, 6220, 9193, 7032, 5, 3957, 1211, 6370, 4919, 6346, 7360, 5468, 3412, 8323, 8578, 4131, 6168, 8683, 5377, 8073, 3410, 1532, 1741, 6206, 3096, 3593, 2910, 1991, 7444, 9054, 6752, 8392, 9201, 7167, 2067, 9105, 7190, 3341, 2557, 8267, 5350, 9262, 308, 6793, 7819, 4169, 2084, 5840, 5203, 9504, 9458, 8993, 2583, 5439, 3761, 6870, 8597, 3809, 5435, 323, 7509, 2457, 4681, 3515, 8080, 751, 7520, 6092, 5109, 3438, 7218, 4782, 6226, 4712, 5172, 5687, 1660, 9904, 927, 4230, 7010, 8886, 3301, 822, 4358, 7300, 2886, 4369, 1854, 4557, 9066, 6294, 9245, 6911, 8145, 3480, 1165, 5235, 128, 8376, 5554, 7023, 7913, 373, 5346, 6324, 6427, 150, 7166, 2169, 5671, 9628, 7657, 406, 4518, 1667, 5868, 3800, 9567, 5171, 4701, 1618, 9089, 664, 5847, 8301, 891, 5762, 8981, 6314, 6601, 5023, 7120, 5170, 5844, 1587, 9805, 9661, 9991, 4112, 8180, 6751, 5055, 6552, 133, 2695, 1096, 6587, 9020, 7441, 6186, 6025, 6891, 7092, 7080, 7621, 1051, 716, 2820, 2332, 9666, 8823, 6140, 1718, 6618, 6607, 3351, 2743, 1594, 7144, 1389, 2139, 6072, 7434, 2409, 3577, 3861, 5189, 9231, 3249, 7429, 5205, 9924, 8057, 5241, 207, 6888, 4054, 4403, 8587, 4643, 4073, 6928, 186, 5367, 7024, 6727, 7411, 4235, 9675, 6260, 4642, 7308, 4243, 404, 5966, 4746, 4841, 9151, 8014, 6992, 7438, 51, 4888, 5682, 6805, 5126, 1379, 2079, 6282, 2778, 8187, 7169, 8039, 6948, 5385, 6323, 6012, 7237, 7679, 5757, 2817, 4684, 1244, 8895, 6535, 4993, 4170, 1829, 3287, 885, 2426, 5639, 2675, 5054, 3439, 159, 4860, 8119, 8440, 4378, 661, 2087, 227, 5592, 8568, 8647, 9900, 4208, 6811, 2896, 7514, 9178, 9154, 6142, 8486, 419, 1080, 1569, 6912, 1952, 5667, 1048, 3459, 4436, 3594, 9851, 1336, 2200, 3119, 1866, 3469, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
