
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {7285, 8411, 8005, 8437, 544, 5613, 5403, 1416, 7850, 3708, 4976, 6039, 7663, 2962, 3322, 9268, 185, 8783, 5847, 8507, 685, 1342, 4092, 8806, 786, 8641, 6994, 3704, 8503, 3404, 2841, 158, 4357, 3932, 4894, 1843, 1718, 8664, 2912, 2451, 4581, 7183, 8312, 2525, 2184, 6206, 9228, 8690, 3919, 1275, 5113, 748, 328, 4781, 7524, 7025, 9810, 1142, 1397, 2459, 4443, 1340, 659, 4274, 9547, 8425, 377, 2181, 8854, 187, 4820, 9336, 5399, 1761, 4039, 3809, 5027, 9996, 3373, 6012, 4721, 4219, 1705, 4040, 9289, 7536, 6853, 3648, 1651, 9865, 1072, 2697, 8359, 236, 9263, 4179, 3140, 1, 2237, 3605, 5872, 8481, 676, 8585, 6877, 1596, 4557, 747, 7108, 8796, 4378, 105, 5323, 953, 2588, 3642, 5599, 7059, 530, 7097, 1970, 3094, 3054, 9659, 8493, 5503, 2410, 7580, 5676, 9272, 5545, 1962, 9137, 26, 4220, 9438, 921, 3610, 8582, 8243, 9920, 3728, 7689, 7049, 3387, 6999, 7997, 8004, 7004, 2334, 56, 4428, 7491, 5776, 5508, 3092, 1373, 542, 6808, 8596, 7826, 6595, 6640, 3405, 9611, 1669, 2325, 9990, 960, 2246, 3217, 3606, 3424, 7465, 5830, 1438, 9670, 5519, 2199, 4029, 4170, 7833, 218, 8592, 9177, 9631, 3491, 6554, 8700, 2930, 9033, 7215, 6367, 7410, 1276, 4675, 5761, 8588, 3438, 7696, 1288, 4559, 2885, 7185, 8634, 2659, 1224, 2300, 2951, 1947, 7095, 7572, 6235, 5219, 98, 6098, 3903, 5875, 5350, 3900, 9988, 9483, 8414, 797, 7478, 7399, 581, 5687, 499, 9545, 5368, 208, 6431, 1267, 9821, 646, 4491, 633, 8318, 4184, 9780, 1666, 8999, 4319, 6417, 8622, 4409, 4676, 5201, 5653, 6534, 9716, 1316, 8280, 3637, 6458, 4913, 4164, 3210, 2311, 7128, 7291, 9718, 398, 2189, 2866, 9304, 577, 4506, 5264, 8877, 2670, 6912, 4525, 1587, 6771, 1471, 7621, 3084, 1388, 3490, 2612, 8771, 29, 609, 863, 3073, 5167, 5754, 6289, 1838, 4590, 9600, 9305, 9225, 4370, 2254, 6684, 4480, 4372, 1685, 5287, 6977, 1245, 2508, 4486, 2271, 7290, 1415, 7672, 9995, 7475, 6193, 8920, 1659, 7666, 1191, 4861, 9552, 8573, 1719, 1868, 949, 4248, 8721, 2109, 4937, 5235, 280, 431, 9011, 7110, 2, 5283, 8211, 1347, 9488, 6059, 9085, 6685, 4650, 3117, 8256, 5052, 5953, 617, 1125, 138, 8963, 7413, 2786, 9989, 5746, 5132, 6976, 1960, 8102, 3150, 6761, 7046, 7219, 7389, 8387, 2610, 6333, 2487, 4616, 7323, 5933, 222, 7798, 6874, 1728, 4460, 8092, 842, 3497, 8843, 817, 8956, 1920, 5833, -1},
        (int[]) {6202, 9298, 2298, 3119, 6054, 1053, 3680, 1611, 5047, 7983, 5264, 3021, 5318, 4932, 3516, 4959, 2643, 7287, 1740, 992, 2605, 3121, 7244, 9030, 1949, 2038, 8996, 8060, 9120, 2165, 991, 1043, 1944, 1111, 7510, 5752, 6138, 8022, 3444, 4651, 1292, 6443, 8841, 3832, 9777, 4848, 2027, 4897, 4366, 6111, 2857, 7727, 374, 1587, 4907, 1422, 8378, 4928, 5622, 9378, 6819, 525, 5184, 4200, 7964, 8151, 3591, 8914, 3848, 3330, 2496, 5162, 7182, 9396, 9894, 4645, 1649, 2208, 1451, 3696, 5798, 190, 2842, 1632, 9789, 3744, 731, 8513, 9305, 7212, 3803, 9056, 8197, 1131, 2016, 3463, 1055, 138, 2790, 9279, 5674, 2472, 8076, 7016, 6456, 4764, 5520, 855, 9651, 2182, 802, 6936, 2437, 6374, 1980, 96, 1659, 7539, 6956, 2059, 3820, 5802, 8856, 4261, 2935, 4652, 7024, 5384, 7351, 2820, 4535, 5008, 9422, 7820, 387, 3873, 5523, 1797, 581, 5342, 3882, 5166, 2440, 6655, 5151, 4560, 3446, 6930, 3841, 5174, 3613, 8758, 7691, 7887, 4217, 730, 3948, 9820, 5566, 7770, 6661, 5253, 2742, 856, 9293, 7553, 3221, 7052, 9650, 3990, 4516, 3145, 7566, 3884, 661, 2233, 8252, 5854, 7520, 5554, 3698, 25, 1126, 6167, 7433, 4194, 6648, 4249, 5865, 8870, 7638, 5079, 4795, 6115, 1347, 3182, 9233, 3443, 6384, 9934, 4892, 4221, 3332, 2923, 1441, 7465, 6982, 5664, 516, 9812, 8276, 3766, 4859, 3040, 5239, 999, 9872, 9042, 4831, 6022, 7463, 2531, 7653, 7316, 4090, 4084, 5295, 7149, 9590, 1713, 9002, 1256, 1456, 667, 8601, 3729, 1061, 8361, 8211, 1880, 9512, 7658, 6564, 4199, 4060, 7598, 7532, 4657, 1122, 3169, 5878, 2760, 2509, 9157, 7564, 9530, 428, 6667, 4552, 121, 5213, 3307, 4441, 9275, 6525, 4367, 1162, 5220, 831, 6024, 2232, 7164, 8989, 6547, 3254, 3817, 6363, 6323, 3835, 8424, 4440, 3945, 7749, 9668, 2690, 4437, 1583, 3126, 3779, 8912, 2615, 8493, 9223, 522, 5483, 6510, 3455, 5229, 5447, 7840, 3217, 8492, 7247, 2783, 7477, 7460, 3404, 3178, 5358, 5528, 5516, 1700, 4826, 1835, 9941, 2429, 675, 4247, 9004, 5133, 913, 6743, 4824, 9193, 7816, 8070, 5316, 7402, 9121, 715, 6304, 4569, 444, 8125, 2625, 1738, 3499, 2649, 7395, 6913, 6728, 9754, 9637, 7635, 1239, 2224, 7013, 5145, 9038, 6264, 175, 3250, 713, 6669, 7030, 1017, 3411, 4695, 825, 9863, 6945, 2729, 960, 3474, 9869, 6699, 346, 5014, 2247, 9426, 4744, 5061, 2530, 4767, 698, 9614, 2538, 9303, 8853, 1626, 8082, 2915, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
