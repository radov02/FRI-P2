
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {2456, 715, 7546, 6081, 3480, 8508, 7763, 2564, 4292, 8997, 2374, 7558, 9526, 242, 4752, 1106, 2932, 6346, 8092, 1907, 3917, 6616, 2226, 6610, 846, 6666, 2619, 8365, 2565, 1213, 1175, 1785, 784, 6471, 8797, 5362, 3403, 1124, 4805, 6354, 668, 97, 8116, 4872, 7263, 5519, 8608, 1129, 7795, 5582, 9929, 9260, 8198, 8072, 32, 2524, 2197, 593, 5388, 7163, 6556, 5594, 7381, 8660, 6756, 1583, 5152, 8287, 8375, 8399, 3286, 8526, 1615, 6225, 2870, 3309, 1678, 6910, 3301, 4480, 8794, 918, 3838, 4642, 2866, 8979, 6428, 2092, 2164, 2189, 3364, 2345, 4221, 1879, 8974, 7520, 5500, -1},
        (int[]) {5002, 7419, 7926, 1556, 7389, 3222, 5631, 6972, 412, 8993, 1959, 7182, 8986, 705, 2485, 5454, 8588, 980, 4649, 8044, 7170, 4521, 7156, 6828, 3140, 1101, 1716, 7267, 6107, 5619, 7899, 5206, 8817, 6206, 5938, 4510, 4785, 752, 7468, 6620, 161, 6219, 6278, 6508, 9785, 3991, 6326, 9839, 7420, 8672, 9482, 5935, 9835, 7172, 3386, 151, 1646, 2732, 80, 9918, 7679, 2216, 865, 4933, 6210, 9737, 3712, 8925, 5465, 163, 9597, 3818, 8281, 2600, 5298, 5302, 904, 4761, 9937, 2767, 881, 8745, 5773, 3133, 7525, 3137, 2928, 8458, 3260, 2374, 644, 1062, 5497, 4482, 8493, 7506, 4373, -1},
        (int[]) {5507, 268, 7324, 6049, 7764, 2421, 6647, 3547, 20, 4648, 3712, 4862, 4219, 3045, 1745, 5631, 4640, 4128, 9715, 7485, 9559, 8845, 9393, 8964, 2410, 3423, 275, 7109, 8904, 5865, 1794, 3767, 505, 5622, 7018, 6372, 1698, 151, 3443, 7474, 2399, 6801, 5415, 3820, 9985, 9377, 5955, 4716, 7124, 4614, 9884, 4099, 5428, 9054, 9669, 2735, 941, 2330, 7195, 7089, 9721, 6862, 9842, 7945, 9441, 8133, 2682, 7323, 3164, 2100, 7086, 909, 9738, 8301, 4422, 6963, 7502, 2644, 6394, 7068, 6439, 1743, 6458, 9050, 8694, 2299, 7617, 3955, 6644, 153, 7736, 5557, 5326, 8230, 6314, 6737, 844, -1},
        (int[]) {7140, 1635, 8447, 656, 3608, 4788, 8485, 5382, 6473, 7942, 4654, 8233, 4205, 623, 5934, 2720, 4653, 3916, 3452, 707, 6493, 4400, 6291, 9268, 1342, 1222, 6613, 4581, 5670, 9850, 2614, 5540, 4089, 1987, 9208, 8147, 5194, 4039, 8202, 8714, 9363, 9590, 3930, 2895, 1545, 2094, 3170, 9803, 8028, 7913, 7609, 9375, 4658, 2779, 6055, 276, 6047, 1595, 456, 1475, 9421, 5279, 4673, 9891, 4721, 4486, 934, 7497, 3011, 8679, 4120, 5130, 1586, 6277, 5521, 4515, 316, 1977, 63, 8585, 7654, 6183, 565, 8251, 3615, 7100, 4350, 5328, 7465, 4729, 1883, 1747, 8929, 2347, 389, 8529, 1632, -1},
        (int[]) {3776, 8278, 5766, 6700, 194, 8330, 4442, 6301, 1345, 2931, 1002, 2177, 5503, 7583, 3960, 2229, 7917, 7353, 8296, 6967, 4666, 5905, 6131, 1390, 5220, 6771, 8788, 2264, 9995, 7138, 8013, 4048, 4477, 7407, 3654, 6636, 6300, 1980, 1531, 6681, 4414, 3193, 2671, 501, 8626, 2403, 7869, 1526, 7927, 4315, 6648, 9665, 6296, 2306, 374, 2395, 1183, 9769, 8131, 4819, 5192, 6065, 9238, 2132, 6124, 6754, 1818, 1429, 2278, 1924, 6609, 9904, 7791, 6238, 2455, 7161, 8242, 9932, 7920, 9163, 5761, 8467, 6891, 2509, 8561, 6677, 5877, 7502, 2476, 582, 2684, 2457, 2170, 3564, 6168, 1115, 6267, -1},
        (int[]) {3305, 2409, 5880, 6482, 7766, 3370, 5280, 6578, 8773, 6665, 5888, 4367, 3984, 5613, 9876, 1890, 5169, 9836, 2513, 688, 3813, 3369, 7047, 5491, 1981, 867, 9662, 1465, 8275, 2651, 5176, 7190, 7816, 2274, 6931, 7956, 7806, 2793, 897, 6557, 7115, 7018, 6015, 2254, 225, 9143, 9660, 419, 3170, 5571, 8914, 4456, 5519, 9515, 7130, 756, 6277, 9965, 7141, 2331, 7488, 9838, 7840, 668, 9235, 9138, 865, 3912, 1094, 44, 9094, 836, 6514, 4653, 1341, 4152, 8099, 476, 3861, 7693, 5793, 4705, 2902, 4172, 3379, 9256, 367, 643, 3790, 6608, 561, 5798, 9860, 2884, 3525, 3533, 8383, -1},
        (int[]) {2090, 8130, 6602, 1856, 576, 1641, 9616, 142, 6771, 8536, 3455, 7302, 5369, 8386, 6652, 2521, 9964, 7227, 5924, 8842, 6103, 4145, 3801, 4156, 3525, 2563, 2429, 3200, 9820, 8846, 1544, 3016, 8690, 1974, 7396, 6911, 3697, 5968, 3257, 489, 5673, 3629, 16, 7916, 454, 5547, 6991, 538, 3792, 4518, 4838, 2313, 6508, 9320, 7402, 7214, 7644, 1868, 2153, 6845, 4345, 396, 4135, 1720, 1128, 5593, 9459, 1246, 9448, 1435, 1163, 4407, 376, 4757, 5068, 7983, 2899, 9256, 2560, 4734, 9102, 2628, 3936, 8865, 1142, 6116, 3230, 7136, 3474, 2169, 1123, 9014, 7392, 9272, 8390, 7590, 632, -1},
        (int[]) {2076, 3915, 8302, 6374, 9058, 5588, 1092, 8272, 7960, 428, 8333, 4067, 831, 424, 7728, 9464, 4349, 7853, 6231, 2237, 2353, 6688, 5587, 5938, 2625, 8910, 122, 8231, 952, 3364, 470, 3276, 5050, 5830, 533, 1741, 2406, 4435, 5043, 9794, 6996, 5512, 1557, 6520, 2870, 313, 987, 6213, 8900, 1574, 6426, 142, 4853, 2488, 2715, 2177, 9153, 7253, 1671, 3093, 1027, 7384, 763, 5602, 4521, 3396, 8227, 2923, 3076, 7059, 678, 872, 6874, 6418, 8585, 2231, 8735, 4780, 3971, 1720, 4141, 6443, 989, 6643, 5809, 5450, 7619, 570, 1734, 2677, 7982, 5167, 502, 2962, 7349, 9804, 2693, -1},
        (int[]) {6012, 831, 8649, 4897, 1911, 299, 6721, 6233, 7645, 6496, 8278, 8860, 6703, 2210, 2791, 3849, 2804, 3932, 5880, 2901, 1382, 1515, 3834, 5398, 7915, 574, 3290, 9233, 8585, 1838, 237, 4109, 5625, 8875, 5942, 3827, 9329, 4374, 979, 258, 7048, 3756, 4448, 87, 7076, 7291, 2355, 8162, 970, 9003, 2848, 4894, 6256, 3091, 6869, 4157, 785, 5158, 5965, 8927, 3813, 4384, 1954, 1628, 9705, 6135, 5517, 9277, 2323, 4291, 8688, 5938, 6958, 6003, 4075, 5075, 7933, 7016, 6713, 4712, 5354, 5927, 5049, 6273, 7267, 9513, 7787, 9879, 6068, 4634, 1634, 5232, 9999, 3840, 5716, 944, 692, -1},
        (int[]) {5738, 1535, 9646, 9664, 6376, 2101, 5286, 4180, 1619, 5073, 9403, 5166, 4633, 8717, 7996, 901, 3005, 7732, 2315, 3283, 3705, 6856, 1539, 9202, 6527, 7467, 3344, 5201, 6644, 3307, 5819, 2471, 6912, 4516, 9584, 3861, 6068, 4440, 880, 160, 4307, 2898, 8887, 3783, 8804, 2750, 6168, 695, 7473, 9400, 8267, 2564, 9094, 9923, 8329, 3726, 1728, 6744, 9140, 584, 3179, 6849, 4, 3594, 3427, 1849, 9511, 5665, 6278, 9505, 2640, 7474, 7970, 5371, 8709, 2289, 8583, 5221, 1614, 3513, 1362, 6433, 6759, 5490, 5509, 6808, 1789, 2795, 8723, 1338, 246, 4254, 1725, 8921, 9922, 1276, 9464, -1},
        (int[]) {8226, 9498, 4761, 3448, 5505, 5520, 2826, 2026, 4523, 9045, 8862, 7359, 2215, 6325, 8396, 2595, 3635, 2000, 3889, 7336, 1457, 1358, 631, 2300, 1990, 1940, 1123, 1827, 1303, 8306, 5557, 6778, 8784, 2369, 5154, 8300, 6432, 8399, 3020, 713, 4102, 9793, 7046, 9380, 517, 5540, 5835, 9356, 9785, 7193, 4801, 3256, 4371, 4939, 3014, 5801, 1757, 4865, 8909, 1536, 1730, 4047, 9248, 2618, 8667, 4690, 1388, 3660, 5214, 7444, 9672, 6846, 6813, 6712, 4584, 2784, 8801, 905, 1432, 3483, 8468, 2972, 627, 9113, 9302, 9016, 8389, 2841, 7436, 8003, 2549, 6685, 9606, 7401, 976, 7366, 1911, -1},
        (int[]) {2835, 4765, 731, 7611, 8541, 6902, 2859, 936, 1000, 7576, 5608, 3778, 1414, 7717, 532, 4039, 6435, 529, 8805, 6622, 5692, 972, 59, 4454, 7405, 9560, 7592, 401, 9511, 8832, 2779, 9317, 9851, 3535, 3639, 5970, 2091, 4069, 1465, 2281, 6859, 212, 5018, 2847, 5626, 123, 4577, 2086, 8699, 7099, 3692, 4307, 5319, 5709, 7831, 1172, 5229, 2743, 1157, 8333, 3897, 7513, 5887, 6036, 3952, 1496, 1670, 5335, 5803, 6438, 2684, 1677, 7759, 8768, 3196, 2080, 4918, 4290, 297, 6459, 3431, 6944, 1266, 588, 1251, 8732, 9769, 5456, 4954, 498, 317, 7210, 9359, 2234, 3061, 8150, 1574, -1},
        (int[]) {8885, 3821, 7585, 1450, 6174, 2438, 6580, 9195, 1971, 5513, 7874, 790, 7900, 8850, 4237, 1910, 4575, 1759, 1081, 4167, 1939, 1639, 5381, 5085, 772, 5165, 7236, 5958, 6489, 3712, 6953, 7227, 7406, 3096, 5702, 9227, 468, 1924, 4326, 7999, 8636, 8050, 5561, 6132, 8928, 5576, 1521, 6951, 4717, 4487, 6905, 8089, 99, 8153, 2409, 6613, 5969, 2684, 5326, 5758, 449, 1258, 6811, 551, 222, 4828, 7052, 8618, 5107, 5552, 9798, 7433, 9758, 3715, 4207, 8457, 9210, 8043, 9054, 8130, 909, 3691, 3164, 2015, 9357, 3446, 508, 7361, 6893, 709, 6490, 5904, 3232, 9808, 6197, 4025, 5986, -1},
        (int[]) {3871, 7240, 9033, 5486, 7167, 3205, 7306, 9134, 8830, 205, 111, 8500, 7993, 9355, 3079, 5126, 2440, 3329, 3092, 4175, 6842, 5243, 8412, 4580, 9600, 7784, 3190, 28, 8485, 2904, 897, 9024, 2126, 2825, 6420, 1993, 571, 3185, 9517, 8497, 623, 941, 6686, 4552, 4380, 6072, 5085, 358, 3649, 8300, 2976, 6468, 5052, 6844, 7027, 1478, 4659, 6643, 1227, 4694, 6580, 6400, 9225, 5065, 4227, 1471, 7756, 5831, 2965, 6501, 8814, 5074, 6305, 810, 4198, 5152, 2630, 1252, 5200, 2723, 5451, 1972, 8261, 1432, 4004, 711, 3877, 4519, 8688, 4734, 4720, 6001, 5631, 675, 1443, 6913, 9673, -1},
        (int[]) {8986, 4123, 6369, 6103, 4, 1855, 6034, 3367, 8134, 6250, 4764, 2280, 947, 7211, 7755, 1538, 4023, 606, 5393, 6314, 2335, 8777, 9523, 970, 8253, 3803, 687, 1605, 4129, 5596, 7707, 7777, 5134, 501, 6734, 3261, 7631, 723, 6087, 8474, 9792, 2749, 9541, 3425, 4201, 295, 5801, 7620, 9464, 6535, 5915, 1604, 5407, 2408, 7589, 7917, 1692, 3493, 503, 4748, 734, 8288, 1540, 8439, 64, 5912, 1387, 9008, 3113, 4089, 6989, 1840, 8123, 394, 4712, 7981, 3452, 9059, 6142, 198, 9357, 9693, 4899, 4157, 7584, 3060, 1742, 2425, 4280, 6719, 9161, 8045, 409, 6469, 9661, 4483, 6144, -1},
        (int[]) {1879, 4201, 5635, 6798, 9697, 9934, 1464, 4847, 7848, 8117, 2884, 4623, 3187, 696, 6214, 8548, 7622, 2762, 4253, 2373, 4670, 6019, 564, 5602, 6353, 9440, 8565, 3648, 1493, 8321, 3005, 7737, 4505, 7669, 5387, 7768, 1790, 5336, 112, 9922, 2864, 4881, 4894, 3665, 9750, 3315, 8941, 5145, 1077, 9451, 8484, 1583, 2255, 6667, 6834, 6793, 6499, 9221, 5799, 8620, 4637, 2031, 528, 5578, 4138, 5024, 1004, 9213, 5625, 6739, 7865, 9782, 7377, 640, 3717, 8946, 791, 2170, 5162, 1031, 429, 787, 9346, 9579, 5196, 3288, 430, 3, 8293, 3177, 5857, 7013, 5988, 4470, 9113, 7091, 5265, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
