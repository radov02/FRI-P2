
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {2654, 7026, 682, 9258, 3608, 5848, 762, 220, 8094, 1572, 8660, 3646, 5941, 7393, 9314, 2979, 9194, 6404, 9448, 4599, 1171, 2604, 1305, 3271, 3674, 7020, 3783, 1404, 64, 2937, 4830, 389, 8583, 9190, 1506, 5598, 3889, 2381, 4052, 2333, 1704, 2879, 4988, 1145, 6662, 6101, 5633, 7002, 4370, 3744, 8885, 962, 2340, 6410, 5688, 1204, 6191, 9434, 9510, 7356, 4354, 8437, 9129, 5671, 3299, -1},
        (int[]) {3151, 641, 8481, 6654, 2765, 1850, 7342, 8043, 5155, 4318, 4009, 7009, 5757, 2974, 3757, 6187, 2767, 6375, 2262, 8877, 9573, 1090, 3193, 2956, 747, 3327, 7405, 4006, 6284, 1171, 9008, 3480, 5031, 8261, 1950, 6064, 4922, 1429, 8367, 1674, 3450, 1188, 9457, 1558, 9966, 8393, 6098, 2212, 3745, 529, 4552, 5340, 3747, 4628, 1677, 7996, 4812, 7355, 3138, 8184, 8372, 9920, 1682, 7008, 1220, 5625, 6072, 9082, 8288, 1197, 693, 7725, 271, 93, 8497, 3614, 645, 8737, 6690, 2052, 9962, 242, 5119, 6699, 4585, 7300, 8615, 9284, 2859, 4359, 7875, 7209, 2727, 8195, 5000, 4507, -1},
        (int[]) {2096, 3519, 6150, 8457, 4504, 4849, 2590, 6277, 3808, 7693, 1928, 7127, 6452, 4046, 9781, 8755, 8845, 2428, 2081, 5660, 5655, 6012, 3529, 6369, 2499, 7718, 4873, 4232, 4517, 3128, 8475, 3854, 9882, 6250, 2567, 434, 7033, 9964, 1862, 4055, 7965, 4362, 180, 793, 9500, 9458, 5017, 7584, 94, 3287, 879, 7861, 1882, 3875, 8758, 2020, 4126, 9154, 8309, 9630, 829, 5359, 5387, 2552, 7894, 2909, 5950, 3261, 7053, 5316, 8088, 8747, 5748, 6727, 3060, 1259, 4474, 3509, 6843, 6423, 5537, 2741, 3792, 222, 4716, 8433, 8799, 8539, -1},
        (int[]) {3599, 9320, 940, 9797, 7234, 1644, 2771, 3951, 4287, 7510, 8814, 9492, 1470, 8192, 7698, 4556, 5597, 3693, 5810, 6575, 2667, 1137, 1739, 4954, 2895, 2428, 8493, 646, 4439, 1821, 1987, 3013, 2687, 7528, 9904, 630, 9858, 4574, 5524, 9733, 4281, 1395, 4284, 5036, 3484, 3745, 9216, 377, 3937, 9087, 9227, 7845, 6036, 881, 6247, 3217, 1363, 4571, 9616, 7001, 450, 1781, 9143, 2288, 5289, 2760, 3173, 825, 7340, 6385, 2354, 7247, 9868, 3756, 3434, 7989, 9857, 3574, 1467, 4391, -1},
        (int[]) {8517, 2394, 6644, 6002, 1760, 2241, 3767, 2212, 977, 999, 8179, 7453, 496, 1684, 4871, 3902, 7119, 6085, 7139, 4442, 503, 8086, 2617, 732, 6909, 9549, 5733, 2510, 4473, 5516, 6203, 7007, 9597, 1825, 5816, 8097, 4181, 168, 1412, 4527, 6394, 4426, 854, 3847, 3513, 5198, 2627, 3363, 7848, 2271, 8197, 1746, 6407, 4227, 194, 34, 3095, 609, 1547, 1379, 8266, 3690, 3399, 9591, 8943, 3749, 6474, 2738, 3712, 9423, 4353, 6867, -1},
        (int[]) {1284, 8702, 6270, 2593, 5661, 8216, 4453, 3234, 5, 2434, 4035, 7454, 3005, 7281, 5796, 9454, 9635, 730, 8592, 349, 9600, 2765, 7402, 6496, 5491, 6765, 9562, 1588, 2836, 4802, 806, 7342, 9106, 9503, 7169, 4990, 8160, 1677, 2084, 8884, 2503, 3685, 2485, 7464, 8578, 9034, 3644, 9005, 5161, 6920, 4131, 5599, 4162, 869, 5421, 8335, 311, 5645, 2447, 4004, 6614, 4811, 6191, -1},
        (int[]) {248, 329, 9293, 4959, 2931, 1903, 4568, 4093, 5106, 1915, 8477, 2595, 4636, 505, 2567, 2018, 8039, 7223, 7820, 2732, 9817, 5508, 9460, 8098, 3244, 7476, 2412, 7088, 7386, 496, 7097, 1227, 9902, 1649, 6736, 7779, 3364, 9484, 5739, 2261, 2484, 3466, 5049, 8856, 2516, 624, 4028, 1836, 5253, 4623, 3772, 7828, 3784, 3681, 6442, 5426, 3645, 1212, 6432, 5517, 8468, 1744, 1778, 7679, 4180, 3825, 2539, 6843, 8586, 6720, 2662, 3917, 2575, 6124, 7866, 7419, 4516, 6878, 8115, 5401, 4302, 5714, 1704, 5962, 4986, 9499, 512, 6968, 7897, -1},
        (int[]) {9400, 4978, 7828, 1315, 9869, 1925, 7200, 9240, 5608, 6186, 3721, 9473, 823, 5413, 1941, 3090, 2550, 6920, 9008, 7290, 3791, 3026, 1969, 1634, 4741, 4682, 7832, 2690, 7061, 6192, 9421, 8887, 1352, 7723, 2872, 7909, 6364, 3603, 7936, 9703, 4968, 8284, 89, 8799, 9774, 420, 1198, 1224, 2455, 8542, 1856, 7054, 8488, 6706, 6745, 2263, 5130, 5930, 1694, 7493, 4176, 8970, 8706, 5003, 3713, 1275, 6420, 530, 6078, 7780, 7405, 9085, 428, 4154, 671, 6728, -1},
        (int[]) {3607, 9261, 3254, 3413, 7125, 2715, 517, 4041, 1653, 4348, 7265, 9973, 4844, 7381, 9457, 6668, 9151, 7198, 7142, 3464, 26, 2011, 4006, 4254, 9164, 4769, 6676, 9729, 7500, 2592, 7762, 6262, 1498, -1},
        (int[]) {3742, 6815, 2744, 2338, 8703, 4799, 5695, 5392, 5135, 1242, 8331, 9033, 6083, 8365, 4267, 3193, 5628, 1827, 6344, 6485, 3358, 946, 5872, 4611, 6955, 3155, 9104, 6927, 5892, 5316, 81, 6352, 6251, 6614, 8731, 5430, 5332, 6774, 1623, 1720, 7039, 8200, 8789, 4291, 1803, 4553, 1448, 753, 995, 9527, 4482, 9133, 7221, 4718, 1031, 6935, 5847, 4755, 4780, 5055, 3447, 8298, 4214, 3820, 4956, 2039, 2765, 461, 6782, 8437, 784, 3850, 2614, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
