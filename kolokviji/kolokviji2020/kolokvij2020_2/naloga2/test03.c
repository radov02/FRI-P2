
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "naloga2.h"

#define MAX_ST_NASLOVOV 1000000

Vozlisce* izdelaj(int* t, long* naslovi, int* stNaslovov) {
    if (*t < 0) {
        return NULL;
    }
    Vozlisce* v = malloc(sizeof(Vozlisce));
    naslovi[(*stNaslovov)++] = (long) v;
    v->podatek = *t;
    v->naslednje = izdelaj(t + 1, naslovi, stNaslovov);
    return v;
}

void izpisi(Vozlisce* v) {
    printf("[");
    Vozlisce* p = v;
    while (p != NULL) {
        if (p != v) {
            printf(", ");
        }
        printf("%d", p->podatek);
        p = p->naslednje;
    }
    printf("]\n");
}

void pocisti(Vozlisce* v) {
    if (v != NULL) {
        pocisti(v->naslednje);
        free(v);
    }
}

int primerjalnik(const void* pa, const void* pb) {
    long a = *(long*) pa;
    long b = *(long*) pb;
    return (a < b) ? (-1) : ((a > b) ? 1 : 0);
}

bool preveri(Vozlisce* seznam, long* naslovi, int stNaslovov) {
    Vozlisce* p = seznam;
    while (p != NULL) {
        long naslov = (long) p;
        if (bsearch(&naslov, naslovi, stNaslovov, sizeof(long), primerjalnik) != NULL) {
            return false;
        }
        p = p->naslednje;
    }
    return true;
}

int __main__() {
    int* t[] = {
        (int[]) {2492, 7267, 784, 6835, 3869, 4460, 7475, 2835, 1908, 8412, 3892, 7781, 8591, 3756, 6745, 539, 4387, 8652, 5300, 547, 7146, 5299, 4534, 7764, 1664, 1171, 3633, 1215, 8884, 9855, 137, 694, 214, 5885, 6664, 339, 7521, 9215, 6781, 101, 3974, 3724, 5089, 8732, 3083, 2842, 6676, 366, 7359, 1482, 2403, 5956, 9300, 9362, 9021, 1566, 6620, 8334, 6730, 3641, 6408, 1039, 9715, 7145, 5390, 8156, 5864, 298, 7651, 8646, 1307, 7919, 3899, 3973, 6914, 5289, 6186, 6995, 5897, 3611, 6321, 3079, 9844, 4473, 6799, 4348, 3610, 1926, 9581, 6801, 3626, 2827, 712, 9293, 6943, 2090, 472, 6817, 923, 9382, 4726, 5540, 7493, 2545, 9139, 1604, 9349, 3363, 7594, 6844, 374, 4767, 3674, 7077, 6468, 5100, 5873, 3742, 6626, 3712, 3783, 3911, 9047, 9089, 6532, 5906, 193, 1817, 5533, 3570, 5618, 9686, 7139, 3995, 4856, 1920, 133, 8482, 1490, 1516, 5187, 8969, 3730, 392, 4255, 9609, 2420, 6435, 2836, 9885, 5275, 1515, 7567, 1197, 9071, 7836, 4826, 588, 9476, 7355, 8581, 6854, 3066, 8684, 6383, 495, 5013, 5814, 412, 8795, 5511, 2942, 3287, 7264, 5030, 6282, 2910, 4008, 6691, 223, 3544, 5538, 6266, 5525, 7776, 1298, 5490, 1763, 983, 82, 3594, 3161, 4868, 9120, 2439, 2072, 2488, 7435, 2823, 1672, 683, 9096, 8790, 6787, 7932, 1365, 9324, 4840, 8232, 5960, 9419, 3459, 2293, 5366, 8858, 6130, 9537, 8179, 1917, 4182, 7075, 910, 8378, 8605, 2317, 3981, 4108, 6548, 6681, 6724, 5683, 8087, 437, 113, 1860, 9901, 3120, 307, 9359, 5177, 7650, 5424, 3415, 2413, 1648, 9289, 9408, 6175, 7729, 485, 6390, 4674, 9257, 5681, 1950, 2353, 5657, 977, 4821, 7270, 9011, 2677, 8508, 3510, 5564, 7429, 4760, 7313, 228, 6971, 85, 8804, 8417, 5895, 8864, 6395, 8139, 1764, 8394, 5508, 8170, 5084, 2948, 9363, 313, 1463, 3305, 8238, 4152, 262, 8021, 7069, 8713, 8690, 9285, 5003, 8867, 9350, 3857, 6167, 2743, 4577, 7920, 1446, 4039, 7639, 5702, 2422, 4814, 7101, 7849, 3804, 5961, 6382, 5728, 5992, 2298, 2724, 2655, 787, 802, 6472, 4915, 7999, 9433, 3529, 373, 8645, 9505, 8984, 7791, 5871, 3215, 5389, 8650, 1132, 4400, 2669, 3776, 4820, 911, 6504, 6015, 8594, 551, 4585, 3978, 2392, 227, 9367, 777, 7895, 713, 3701, 2686, 7183, 8702, 72, 927, 8288, 3042, 8477, 3180, 1066, 6780, 9926, 5837, 6346, 7624, 1274, 9006, 6082, 678, 7649, 2460, 316, 9170, 5565, 1108, 9519, 5109, 1200, 6868, 3269, 7953, 2066, 7284, 4927, 7677, 3141, 7072, 773, 4910, 2110, 3159, 6287, 5800, 1057, 8651, 809, 3702, 6840, 7470, 3029, 6281, 9694, 5557, 9405, 5155, 3960, 5427, 2489, 6976, 5181, 3811, 7513, 2166, 4333, 6989, 8390, 4110, 5010, 4272, 8617, 6718, 7847, 3717, 5985, 874, 7094, 2979, 8392, 8321, 4564, 3965, 7620, 3174, 5743, 6324, 6027, 1889, 3182, 1828, 1192, 9415, 5364, 1546, 1370, 1467, 5498, 2363, 9390, 1798, 8226, 441, 7875, 157, 9449, 2478, 290, 664, 2218, 8764, 1986, 3601, 3435, 722, 4727, 4632, 1605, 450, 7816, 5516, 7680, 210, 8667, 9392, 7166, 3513, 1508, 248, 3148, 2277, 4479, 6789, 8096, 7439, 8871, 4330, 6916, 5365, 2295, 3439, 1128, 583, 5751, 5555, 1569, 490, 365, 6749, 75, 6525, 689, 1845, 6124, 7194, 1693, 5975, 5786, 8181, 2873, 6162, 4240, 44, 7910, 9128, 2394, 1574, 264, 1564, 5840, 2174, 8745, 2620, 9050, 2447, 5926, 5948, 4567, 2288, 1097, 8490, 3813, 7842, 5170, 98, 3922, 1576, 9088, 1322, 3485, 5250, 2722, 2614, 6985, 6356, 2602, 8753, 6299, 7033, 4989, 6589, 7076, 166, 4843, 5447, 3325, 5196, 6553, 7670, 670, 6645, 6054, 1475, 9979, 4896, 2236, 5047, 388, 7397, 8086, 3077, 2145, 6616, 8309, 9301, 3203, 9812, 2213, 2854, 5484, 1615, 7273, 9141, 9953, 7022, 5110, 5130, 8002, 6984, 709, 5732, 4026, 1333, 9980, 4379, 2936, 1395, 3880, 8540, 40, 8062, 3721, 7531, 2053, 6421, 8918, 2798, 1929, 3179, 7310, 6433, 4999, 4322, 7960, 6319, 73, 5505, 536, 1737, 6947, 7775, 1938, 9876, 4550, 8848, 8888, 9247, 2157, 3377, 4581, 3759, 2596, 2169, 2017, 8533, 8363, 9025, 4116, 4882, 3194, 9749, 1160, 5569, 3647, 4418, 6127, 7635, 3107, 6359, 3370, 8526, 2679, 5737, 3105, 6674, 3588, 8968, 5436, 488, 8337, 5198, 3726, 8141, 5878, 9398, 4340, 3661, 1104, 4816, 1425, 9940, 8116, 3252, 3369, 23, 5795, 704, 1550, 9067, 8855, 6716, 2963, 1336, 7200, 1281, 6406, 2346, 3540, 1052, 9468, 4836, 1468, 9891, 7579, 5603, 2631, 9764, 408, 8850, 9103, 3803, 3541, 6213, 2, 432, 5687, 3321, 6460, 3007, 9009, 7002, 7905, 3779, 1237, 897, 3490, 7819, 8064, 3761, 1718, 3772, 1614, 2002, 4976, 8730, 3497, 9056, 8244, 4111, 2108, 5883, 3954, 159, 1279, 5471, 39, 665, 8413, 2151, 3975, 7046, 8763, 624, 7647, 5632, 1325, 4081, 9985, 5777, 1628, 8049, 7676, 1313, 519, 5051, 3882, 4793, 1429, 4144, 245, 2051, 2530, 3122, 3279, 9887, 8642, 4866, 1089, 7408, 8631, 7741, 1714, 6244, 6521, 8449, 5628, 7347, 9956, 8151, 5174, -1},
        (int[]) {2635, 1583, 2986, 3075, 3621, 2341, 1004, 3660, 6354, 2724, 51, 7678, 5990, 5016, 1628, 9384, 2213, 3088, 985, 3215, 772, 4003, 1747, 1204, 2826, 7884, 7605, 6487, 5803, 6289, 8004, 5487, 1189, 6254, 5296, 4748, 5565, 5669, 9835, 9111, 8126, 5407, 1679, 3906, 6181, 8055, 2954, 9673, 6811, 4918, 6876, 1305, 2316, 2471, 4107, 5486, 1270, 6538, 8217, 9479, 1517, 263, 4563, 5079, 1337, 3256, 9627, 1857, 2244, 3770, 499, 2801, 3037, 7775, 7501, 6543, 1446, 9337, 4616, 371, 2770, 3459, 2282, 1217, 8532, 5957, 6567, 781, 3038, 7070, 7923, 8274, 8258, 7899, 972, 8424, 7853, 4117, 7887, 104, 1509, 4817, 7736, 4601, 6109, 3554, 9434, 2042, 1137, 8490, 8245, 306, 8828, 1591, 4818, 6108, 8210, 3188, 2584, 3627, 2547, 1054, 3638, 4026, 9956, 3454, 9957, 9401, 2648, 7335, 613, 2622, 4150, 2600, 5718, 3021, 919, 4920, 7149, 8134, 332, 7090, 5920, 451, 7169, 9326, 5479, 7509, 7341, 3656, 1929, 2754, 1479, 4579, 1920, 9919, 6649, 8311, 5042, 2436, 2268, 4758, 3780, 8040, 9398, 2008, 5380, 9958, 50, 8035, 4695, 3230, 2854, 1574, 9884, 8875, 1050, 1371, 5024, 5814, 5831, 2367, 719, 1548, 135, 2091, 4855, 3539, 4619, 4957, 704, 162, 2711, 4533, 1177, 3913, 9055, 3579, 5961, 1231, 6611, 8285, 1396, 8139, 3415, 1829, 7368, 9856, 9408, 27, 4154, 5194, 5318, 5634, 1629, 1096, 9225, 2453, 4048, 614, 3176, 446, 3134, 5345, 8568, 3131, 3483, 7585, 9700, 5314, 7270, 9165, 1359, 9090, 7776, 6660, 9977, 4559, 1027, 5914, 8780, 907, 2440, 9211, 8502, 5381, 2620, 536, 238, 2901, 3223, 4472, 6342, 9985, 6189, 2939, 8912, 4333, 8113, 4961, 1413, 8837, 7288, 6786, 478, 9370, 1404, 2084, 1738, 9194, 6765, 93, 4271, 8375, 6129, 4195, 4422, 9457, 5585, 3059, 5422, 3261, 213, 4434, 6830, 701, 8651, 1381, 8303, 2520, 4396, 6665, 2044, 8626, 3086, 7844, 8821, 8076, 5312, 3155, 507, 4847, 2647, 5482, 5369, 5276, 2578, 801, 8850, 8881, 1476, 3091, 481, 5968, 4982, 6478, 884, 5431, 4942, 1320, 3593, 6918, 6842, 7862, 4119, 7001, 9083, 3167, 3928, 4298, 6025, 556, 8223, 8146, 2074, 1331, 1655, 69, 8191, 3187, 8053, 5932, 7004, 6928, 8891, 4799, 4525, 4801, 2217, 4967, 2275, 7466, 8940, 7236, 3890, 4135, 9677, 960, 1048, 3143, 5974, 2018, 5515, 7819, 1952, 8928, 7851, 5229, 3239, 3811, 7933, 2429, 1825, 7385, 843, 2947, 9363, 7570, 771, 4644, 1498, 8728, 3758, 7204, 5887, 9799, 3530, 6293, 8291, 4292, 5107, 3474, 6187, 6691, 7977, 8180, 7246, 2489, 8218, 8412, 5080, 888, 4776, 2666, 8411, 1024, 9730, 3647, 8112, 2090, 2822, 8415, 4106, 3457, 3816, 5457, 1983, 7434, 8514, 9912, 9066, 2962, 5191, 1500, 7417, 2327, 951, 5717, 217, 627, 7858, 7081, 8561, 2933, 232, 9740, 6134, 6871, 4067, 6510, 3418, 5363, 4895, 1925, 535, 7361, 5216, 1672, 373, 7507, 8807, 4274, 4236, 9028, 6968, 6426, 379, 6901, 7545, 8203, 4680, 9854, 9143, 2107, 9766, 1882, 7974, 7566, 7831, 8754, 1834, 9491, 2132, 9791, 8830, 4526, 9304, 8507, 8269, 1060, 49, 5300, 81, 6809, 1909, 9584, 9930, 4270, 2406, 9005, 4981, 2175, 2448, 8232, 1930, 5129, 2043, 5031, 1222, 1855, 4577, 8247, 3680, 8037, 3707, 1013, 8256, 7183, 2439, 1409, 9864, 1380, 3504, 79, 7719, 796, 3560, 8827, 8392, 5901, 9015, 6600, 665, 4606, 659, 6400, 3101, 2792, 5469, 8773, 422, 6532, 96, 1069, 5582, 4778, 1641, 8417, 2720, 7711, 2891, 1070, 5368, 1414, 9668, 7314, 5688, 684, 4733, 2948, 147, 5387, 6276, 7756, 6673, 2283, 5481, 7253, 549, 5341, 7677, 5632, 6558, 2882, 6321, 5066, 6890, 3625, 672, 779, 64, 7274, 2660, 3022, 8419, 8904, 418, 4466, 4187, 2011, 5743, 8737, 4906, 7663, 4575, 879, 3017, 52, 4250, 5916, 6350, 8207, 4344, 6304, 9672, 6647, 7342, 3409, 6471, 78, 9273, 9660, 3793, 7635, 5313, 9915, 1673, 8335, 2401, 4389, 2171, 9508, 8793, 7120, 3596, 2814, 7219, 679, 7254, 1670, 4005, 5434, 7588, 8622, 6987, 4836, 2032, 3177, 9639, 8504, 7237, 7065, 1890, 286, 5208, 4347, 4239, 7320, 9322, 5499, 1692, 2968, 1269, 910, 500, 3212, 1804, 3489, 762, 5694, 2904, 1593, 3752, 7688, 3567, 5158, 5562, 1138, 5658, 1922, 920, 9906, 6519, 74, 680, 646, 412, 1910, 5203, 7370, 1694, 6525, 4531, 8349, 2262, 8792, 6635, 9869, 8470, 5744, 9044, 9252, 6823, 8722, 5344, 6984, 7321, 8644, 4291, 6926, 9925, 4645, 9428, 8229, 9199, 9532, 7571, 6815, 7013, 6825, 6664, 8649, 2866, 3205, 3843, 4739, 4234, 5480, 1284, 9530, 4212, 4081, 3925, 4723, 578, 824, 3736, 8729, 8915, 4573, 8108, 2682, 5612, 4139, 3941, 1606, 2028, 8135, 6407, 8836, 9794, 3807, 9712, 561, 866, 8401, 6065, 7346, 8994, 7164, 8559, 5215, 3098, 8761, 2564, 2198, 3608, 9024, 7029, 6779, 4693, 9623, 1388, 2004, 8129, 4524, 5011, 7978, 472, 6299, 1223, 7192, 6365, 2534, 3804, 9679, 3810, 9892, 9096, 2984, 511, 630, 983, 7586, 1913, 3782, 3969, 5211, 706, 1349, 7386, 6131, -1},
    };
    int n = sizeof(t) / sizeof(int*);

    Vozlisce** seznami = malloc(n * sizeof(Vozlisce*));
    long* naslovi = malloc(MAX_ST_NASLOVOV * sizeof(long));
    int stNaslovov = 0;
    for (int i = 0;  i < n;  i++) {
        seznami[i] = izdelaj(t[i], naslovi, &stNaslovov);
    }
    qsort(naslovi, stNaslovov, sizeof(long), primerjalnik);

    Vozlisce* prepleten = prepleti(seznami, n);
    if (!preveri(prepleten, naslovi, stNaslovov)) {
        printf("NAPAKA!\n");
        printf("Vsa vozlisca prepletenega seznama morajo biti kopije vozlisc originalnih seznamov.\n");
    }
    izpisi(prepleten);
    pocisti(prepleten);

    for (int i = 0;  i < n;  i++) {
        pocisti(seznami[i]);
    }
    free(seznami);
    free(naslovi);

    exit(0);
    return 0;
}
